<!DOCTYPE html>
<html>
<head>
    <title>MCN | Premium GAC Toolkit</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --mcn-navy: #0A2342;
            --mcn-blue: #0056b3;
            --mcn-light: #e0e7ff;
            --auth-purple: #6b46c1;
            --white: #ffffff;
            --text-dark: #1e293b;
            --text-muted: #64748b;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            margin: 0;
            padding: 40px 20px;
            color: var(--text-dark);
            min-height: 100vh;
        }

        .container {
            max-width: 1050px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(16px);
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: visible; 
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .header {
            background: linear-gradient(to right, var(--mcn-navy), #113c6b);
            padding: 45px 20px;
            text-align: center;
            color: var(--white);
            border-bottom: 5px solid var(--mcn-blue);
            border-radius: 24px 24px 0 0; 
        }

        .logo-container {
            background: var(--white);
            padding: 18px 35px;
            display: inline-block;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
        }

        .logo-img { max-width: 260px; height: auto; display: block; }

        .setup-grid {
            padding: 35px 40px;
            background: var(--white);
            display: grid;
            grid-template-columns: 1fr 120px 100px 140px; 
            gap: 15px;
            align-items: flex-end;
            border-bottom: 1px solid #e2e8f0;
        }

        .field-group label { display: block; font-size: 12px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; color: var(--text-muted); }
        input, select { width: 100%; padding: 16px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 16px; background: #f8fafc; transition: 0.3s; box-sizing: border-box; }
        input:focus { border-color: var(--mcn-blue); outline: none; background: var(--white); box-shadow: 0 0 0 4px rgba(0, 86, 179, 0.1); }

        .btn-primary { background: var(--mcn-blue); color: var(--white); border: none; padding: 16px; border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px; width: 100%; }
        .btn-primary:hover { background: var(--mcn-navy); transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 86, 179, 0.3); }

        .btn-download-draft { background: #4f46e5; color: var(--white); border: none; padding: 16px; border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px; width: 100%; }
        .btn-download-draft:hover { background: #3730a3; transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3); }

        #displayArea { padding: 40px; }

        .impact-card {
            background: var(--white);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
            border-left: 8px solid var(--mcn-blue);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            transition: 0.3s;
        }
        .impact-card:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border-color: #cbd5e1; }
        .card-label { font-size: 12px; font-weight: 900; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 10px; display: block; }
        .card-value { font-size: 18px; line-height: 1.7; color: var(--text-dark); white-space: pre-wrap; }
        
        .card-value a {
            color: var(--mcn-blue);
            text-decoration: none;
            font-weight: 700;
            border-bottom: 2px solid #cbd5e1;
            transition: 0.2s;
            word-break: break-all;
        }
        .card-value a:hover {
            color: var(--mcn-navy);
            border-bottom-color: var(--mcn-navy);
        }

        .auth-suite {
            background: linear-gradient(to right, #f3f0ff, #ffffff);
            border-left: 8px solid var(--auth-purple);
            padding: 30px;
            border-radius: 16px;
            margin: 30px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            display: none;
        }
        .auth-text h3 { margin: 0 0 8px 0; color: var(--auth-purple); font-size: 20px; }
        .auth-text p { margin: 0; color: var(--text-muted); font-size: 15px; }
        .btn-auth { background: var(--auth-purple); color: var(--white); border: none; padding: 16px 24px; border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.3s; text-transform: uppercase; box-shadow: 0 4px 6px rgba(107, 70, 193, 0.2); }
        .btn-auth:hover { background: #553c9a; transform: translateY(-2px); box-shadow: 0 10px 15px rgba(107, 70, 193, 0.3); }

        .nav-buttons { display: flex; justify-content: space-between; margin: 0 40px 30px 40px; padding-top: 30px; border-top: 2px dashed #cbd5e1; display: none; }
        .nav-btn { background: var(--white); color: var(--text-dark); border: 2px solid #cbd5e1; padding: 14px 24px; border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.3s; width: 48%; text-transform: uppercase; }
        .nav-btn:hover { background: #f1f5f9; border-color: var(--text-muted); }

        .eval-board { background: var(--mcn-light); padding: 40px; border-radius: 20px; margin: 0 40px 40px 40px; display: none; }
        .eval-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        
        .btn-copy { background: #0f766e; color: var(--white); border: none; padding: 18px; border-radius: 12px; font-weight: 800; cursor: pointer; width: 100%; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; }
        .btn-copy:hover { background: #115e59; transform: translateY(-2px); box-shadow: 0 10px 15px rgba(15, 118, 110, 0.2); }

        .btn-draft { background: #f59e0b; color: var(--white); border: none; padding: 18px; border-radius: 12px; font-weight: 800; cursor: pointer; width: 100%; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; margin-top: 15px; }
        .btn-draft:hover { background: #d97706; transform: translateY(-2px); box-shadow: 0 10px 15px rgba(245, 158, 11, 0.2); }
        
        .btn-pdf { background: #b91c1c; color: var(--white); border: none; padding: 18px; border-radius: 12px; font-weight: 800; cursor: pointer; width: 100%; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; margin-top: 15px; }
        .btn-pdf:hover { background: #991b1b; transform: translateY(-2px); box-shadow: 0 10px 15px rgba(185, 28, 28, 0.2); }

        .empty-state { text-align: center; padding: 80px 20px; color: var(--text-muted); }
        .empty-state h3 { font-size: 24px; color: var(--mcn-navy); margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container" id="pdfContentArea">
    
    <div class="header">
        <div class="logo-container">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c8/Millennium_Campus_Network_Logo.png/600px-Millennium_Campus_Network_Logo.png" alt="MCN Logo" id="officialLogo" crossorigin="anonymous" style="width: 250px; max-width: 100%; display: block;">
        </div>
        <h1 style="margin:0; font-size: 32px; letter-spacing: -0.5px;">Admissions Reviewers Toolkit</h1>
        <p style="margin:10px 0 0; opacity: 0.9; font-weight: 600; text-transform: uppercase; letter-spacing: 3px; font-size: 13px;">Developed by Akhyear Mushfiqur Rahman, Millennium Fellow'25</p>
    </div>

    <div class="setup-grid" id="setupGrid">
        <div class="field-group">
            <label>Applicant's Responses Datasheet Link</label>
            <input type="text" id="sheetLink" placeholder="Paste your Google Sheet link here...">
        </div>
        <div class="field-group">
            <label>Candidate Row No.</label>
            <input type="number" id="rowNum" value="2">
        </div>
        <button class="btn-primary" onclick="loadData()">Fetch</button>
        <button class="btn-download-draft" onclick="downloadDraftCSV()" id="btnDownload">Get CSV</button>
    </div>

    <div id="displayArea">
        <div class="empty-state">
            <h3>Ready to Evaluate</h3>
            <p>Paste your link and select a row to load a potential changemaker's profile.</p>
        </div>
    </div>

    <div class="auth-suite" id="authSuite">
        <div class="auth-text">
            <h3>Authenticity Check</h3>
            <p>Instantly copy this application and open the QuillBot AI Detector.</p>
        </div>
        <button class="btn-auth" id="btnQuillbot" onclick="checkAuthenticity()">Check with QuillBot &#8599;</button>
    </div>

    <div class="nav-buttons" id="navButtons">
        <button class="nav-btn" onclick="changeRow(-1)">&#8592; Previous</button>
        <button class="nav-btn" onclick="changeRow(1)">Next &#8594;</button>
    </div>

    <div class="eval-board" id="evalBoard">
        <h3 style="margin-top:0; color:var(--mcn-navy); font-size: 22px;">Final Assessment</h3>
        <div class="eval-grid">
            <div class="field-group">
                <label>Proximity to Issue</label>
                <select id="scoreProx">
                    <option value="1">1 - Distant</option>
                    <option value="2">2 - Aware</option>
                    <option value="3">3 - Connected</option>
                    <option value="4">4 - Involved</option>
                    <option value="5">5 - Lived Experience</option>
                </select>
            </div>
            <div class="field-group">
                <label>Leadership Potential</label>
                <select id="scoreLead">
                    <option value="Emerging">Emerging</option>
                    <option value="Strong">Strong</option>
                    <option value="Exceptional">Exceptional</option>
                </select>
            </div>
            <div class="field-group">
                <label>Committee Decision</label>
                <select id="scoreDecision">
                    <option value="Accept">Accept</option>
                    <option value="Waitlist">Waitlist</option>
                    <option value="Decline">Decline</option>
                </select>
            </div>
        </div>
        <button class="btn-copy" onclick="copyScores()" id="btnCopyEval">Copy Scores to Clipboard</button>
        <button class="btn-draft" onclick="saveToDraft()" id="btnDraft">Export to Draft Sheet</button>
        <button class="btn-pdf" onclick="saveAsPDF()" id="btnPdf">Save Profile as PDF</button>
    </div>
</div>

<script>
let currentFullText = "";
let currentApplicantName = "Applicant";

function loadData() {
    let link = document.getElementById('sheetLink').value.trim();
    const rowInput = document.getElementById('rowNum');
    const row = parseInt(rowInput.value);
    const output = document.getElementById('displayArea');
    
    document.getElementById('authSuite').style.display = "none";
    document.getElementById('navButtons').style.display = "none";
    document.getElementById('evalBoard').style.display = "none";

    if (!link) {
        output.innerHTML = "<div class='empty-state' style='color:red;'><h3>Error</h3><p>Please paste your master datasheet link first.</p></div>";
        return;
    }

    if (link.includes('/edit')) {
        link = link.split('/edit')[0] + '/export?format=csv';
    }

    output.innerHTML = "<div class='empty-state'><p>Fetching candidate records...</p></div>";

    Papa.parse(link, {
        download: true,
        header: true,
        complete: function(results) {
            const data = results.data;
            const index = row - 2;

            if (index < 0 || index >= data.length) {
                output.innerHTML = "<div class='empty-state' style='color:red;'><h3>Not Found</h3><p>Candidate row does not exist. Try another number.</p></div>";
                document.getElementById('navButtons').style.display = "flex";
                return;
            }

            const student = data[index];
            currentFullText = ""; 
            
            const firstName = student["First Name"] || "Unknown";
            const lastName = student["Last Name"] || "Candidate";
            currentApplicantName = (firstName + "_" + lastName).trim();

            // FIXED TEXT: Now says "Applicant Profile" instead of "Applicant Dossier"
            let html = "<h2 style='color:var(--mcn-navy); margin-bottom: 25px; font-weight: 800; font-size: 24px;'>Applicant Profile</h2>";

            for (const key in student) {
                if (student[key] && student[key].trim() !== "") {
                    
                    let contentText = student[key];
                    const linkFinder = /(https?:\/\/[^\s]+)/g;
                    contentText = contentText.replace(linkFinder, '<a href="$1" target="_blank" title="Click to open link">$1</a>');

                    html += `<div class="impact-card">
                                <span class="card-label">${key}</span>
                                <div class="card-value">${contentText}</div>
                             </div>`;
                    
                    currentFullText += key + ":\n" + student[key] + "\n\n";
                }
            }
            output.innerHTML = html;
            
            document.getElementById('authSuite').style.display = "flex";
            document.getElementById('navButtons').style.display = "flex";
            document.getElementById('evalBoard').style.display = "block";
            
            document.getElementById('btnQuillbot').innerText = "Check with QuillBot \u2197";
            document.getElementById('btnCopyEval').innerText = "Copy Scores to Clipboard";
        }
    });
}

function checkAuthenticity() {
    const btn = document.getElementById('btnQuillbot');
    navigator.clipboard.writeText(currentFullText).then(() => {
        btn.innerText = "Text Copied! Opening QuillBot...";
        setTimeout(() => {
            window.open('https://quillbot.com/ai-content-detector', '_blank');
            btn.innerText = "Check with QuillBot \u2197";
        }, 1000);
    });
}

function changeRow(step) {
    const rowBox = document.getElementById('rowNum');
    let currentRow = parseInt(rowBox.value);
    let newRow = currentRow + step;
    if (newRow < 2) newRow = 2;
    rowBox.value = newRow;
    loadData();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function copyScores() {
    const prox = document.getElementById('scoreProx').value;
    const lead = document.getElementById('scoreLead').value;
    const decision = document.getElementById('scoreDecision').value;
    const btn = document.getElementById('btnCopyEval');
    
    const combinedAnswers = prox + "    " + lead + "    " + decision;
    
    navigator.clipboard.writeText(combinedAnswers).then(() => {
        btn.innerText = "\u2713 Saved! Paste into your Sheet";
        btn.style.background = "#065f46"; 
        setTimeout(() => {
            btn.innerText = "Copy Scores to Clipboard";
            btn.style.background = "#0f766e";
        }, 3000);
    });
}

function saveToDraft() {
    const row = document.getElementById('rowNum').value;
    const prox = document.getElementById('scoreProx').value;
    const lead = document.getElementById('scoreLead').value;
    const decision = document.getElementById('scoreDecision').value;
    const btn = document.getElementById('btnDraft');

    let drafts = JSON.parse(localStorage.getItem('mcn_eval_drafts')) || {};

    drafts[row] = {
        name: currentApplicantName,
        proximity: prox,
        leadership: lead,
        decision: decision
    };

    localStorage.setItem('mcn_eval_drafts', JSON.stringify(drafts));

    btn.innerText = "\u2713 Added to Draft Memory!";
    btn.style.background = "#b45309"; 
    
    setTimeout(() => {
        btn.innerText = "Export to Draft Sheet";
        btn.style.background = "#f59e0b";
    }, 2500);
}

function downloadDraftCSV() {
    let drafts = JSON.parse(localStorage.getItem('mcn_eval_drafts')) || {};
    let rows = Object.keys(drafts).sort((a, b) => parseInt(a) - parseInt(b));

    if (rows.length === 0) {
        alert("You have not saved any drafts yet! Evaluate a student and click 'Export to Draft Sheet' first.");
        return;
    }

    let csvContent = "Row Number,Applicant Name,Proximity to Issue,Leadership Potential,Committee Decision\n";

    rows.forEach(row => {
        let d = drafts[row];
        csvContent += `${row},"${d.name}","${d.proximity}","${d.leadership}","${d.decision}"\n`;
    });

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    const url = URL.createObjectURL(blob);
    link.setAttribute("href", url);
    link.setAttribute("download", "MCN_Evaluations_Draft.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function saveAsPDF() {
    const btnPdf = document.getElementById('btnPdf');
    btnPdf.innerText = "Scanning Document... Please Wait";
    
    document.getElementById('setupGrid').style.display = 'none';
    document.getElementById('authSuite').style.display = 'none';
    document.getElementById('navButtons').style.display = 'none';
    document.getElementById('btnCopyEval').style.display = 'none';
    document.getElementById('btnDraft').style.display = 'none';
    btnPdf.style.display = 'none';

    const element = document.getElementById('pdfContentArea');

    const originalBackground = element.style.background;
    const originalBackdrop = element.style.backdropFilter;
    const originalShadow = element.style.boxShadow;
    
    element.style.background = '#ffffff'; 
    element.style.backdropFilter = 'none'; 
    element.style.boxShadow = 'none'; 

    const opt = {
        margin:       0.3,
        filename:     currentApplicantName + '_MCN_Evaluation.pdf',
        image:        { type: 'jpeg', quality: 1.0 },
        html2canvas:  { scale: 2, useCORS: true, scrollY: 0, imageTimeout: 15000 },
        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
    };

    html2pdf().set(opt).from(element).save().then(() => {
        element.style.background = originalBackground;
        element.style.backdropFilter = originalBackdrop;
        element.style.boxShadow = originalShadow;

        document.getElementById('setupGrid').style.display = 'grid';
        document.getElementById('authSuite').style.display = 'flex';
        document.getElementById('navButtons').style.display = 'flex';
        document.getElementById('btnCopyEval').style.display = 'block';
        document.getElementById('btnDraft').style.display = 'block';
        btnPdf.style.display = 'block';
        btnPdf.innerText = "Save Profile as PDF";
    });
}
</script>

</body>
</html>
